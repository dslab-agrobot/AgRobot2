# 2.03modbus/TCP协议介绍

Modbus/TCP是一种基于Modbus协议的应用层通信协议，它运行在TCP/IP协议之上，专为以太网通信设计。Modbus/TCP结合了Modbus协议的功能和以太网的广泛使用，使得工业设备之间的通信变得更加灵活和高效。以下是Modbus/TCP协议的一些关键特性和组成部分：

## 协议结构

Modbus/TCP协议的数据单元（PDU）与Modbus RTU或ASCII的PDU相同，都是由功能码（Function Code）和数据（Data）组成。不过，Modbus/TCP在PDU前添加了一个MBAP（Modbus Application Protocol）头，用于处理网络层的地址和TCP连接的管理。

## MBAP头

MBAP头是Modbus/TCP特有的，它包含了以下字段：

- Transaction Identifier (TID)：事务标识符，用于标识和匹配请求和响应。
- Protocol Identifier (PID)：协议标识符，固定为`00 00`表示Modbus/TCP协议。
- Length：表示后续PDU和MBAP头的长度，单位是字节。
- Unit Identifier (UID)：单元标识符，相当于Modbus RTU中的设备地址，用于标识特定的从设备。

## 通信模式

Modbus/TCP保留了Modbus的主从架构，其中主设备（通常是监控系统或操作员工作站）发起请求，从设备（通常是现场的传感器、执行器或其他控制设备）响应这些请求。

## 异常处理

Modbus/TCP协议中，如果从设备无法执行请求的操作，它会发送一个异常响应。这与Modbus RTU的操作相同，但是异常响应的格式会包括MBAP头。

## 连接管理

Modbus/TCP使用TCP连接进行通信，这意味着一旦建立连接，就可以在相同的TCP连接上发送多个Modbus请求和响应，而无需为每个请求建立新的连接。

## 广播

Modbus/TCP支持广播消息，通过将地址字段设置为`FF FF FF FF FF FF`，可以将消息发送给网络上的所有设备。

## 应用场景

Modbus/TCP广泛应用于工业控制系统中，特别是在需要快速、可靠的数据交换的场合。它适用于各种自动化设备，如PLC、DCS、传感器、驱动器等。

## 优点

- 兼容性好：Modbus/TCP保留了Modbus协议的简单性和可靠性，同时利用了以太网的高速和广泛部署。
- 易于集成：由于以太网的普及，Modbus/TCP可以轻松地与现有的IT基础设施集成。
- 支持远程访问：通过TCP/IP网络，Modbus/TCP允许远程监控和控制，无需特殊的硬件或协议转换。

## 缺点

- 依赖于IP网络：Modbus/TCP依赖于IP网络的稳定性和安全性，网络问题可能会影响通信。
- 可能的拥塞：由于TCP的面向连接特性，大量的并发连接可能会导致网络拥塞。

总的来说，Modbus/TCP是一种功能强大的工业通信协议，它结合了Modbus的简单性和以太网的灵活性，适用于现代工业自动化环境。